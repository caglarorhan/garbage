<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cam test 11</title>
</head>
<body>
<label for="barcodeContainingImage">Take a barcode/qrcode picture:</label>

<input type="file"
       id="barcodeContainingImage" name="barcodeContainingImage"
       accept="image/png, image/jpeg" capture="environment">

<span id="theBarcodeValue">BARCODE DATA PLACE</span>

<script>
    const barcodeFormats = ['aztec',
        'code_128',
        'code_39',
        'code_93',
        'codabar',
        'data_matrix',
        'ean_13',
        'ean_8',
        'itf',
        'pdf417',
        'qr_code',
        'upc_a',
        'upc_e']
    const barcodeDetector = new BarcodeDetector({formats: barcodeFormats});
    const barcodeContainingImage = document.getElementById('barcodeContainingImage');
    const theBarcodeValue = document.getElementById('theBarcodeValue');

    barcodeContainingImage.addEventListener('change', function () {
        const fr = new FileReader()
        const file = barcodeContainingImage.files[0]
        fr.readAsArrayBuffer(file)
        fr.onload = function() {
            const img = new Image()
            img.src = fr.result
            img.onload = function() {
                const image = new ImageData(img.width, img.height)
                const context = canvas.getContext('2d')
                context.drawImage(img, 0, 0)
                const imageData = context.getImageData(0, 0, img.width, img.height)
                const code = barcodeDetector.detect(imageData)
                if (code) {
                    theBarcodeValue.innerText = code.rawValue
                }
            }
        }

    })

</script>
</body>
</html>
