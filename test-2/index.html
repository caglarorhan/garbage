<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cam test</title>
</head>
<body>
<label for="barcodeContainingImage">Take a barcode/qrcode picture:</label>

<input type="file"
       id="barcodeContainingImage" name="barcodeContainingImage"
       accept="image/png, image/jpeg" capture="environment">

<span id="theBarcodeValue"></span>



<script>
    window.addEventListener('load',()=>{
        let barcodeContainingImage = document.getElementById('barcodeContainingImage');
        barcodeContainingImage.addEventListener('change',()=>{
            let file = barcodeContainingImage.files[0];
            let reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = ()=>{
bD.detect(reader.result);
                // let base64 = reader.result;
                // let img = document.createElement('img');
                // img.src = base64;
                // img.width = 200;
                // img.height = 200;
                // document.body.appendChild(img);
                // let barcodeValue = document.getElementById('theBarcodeValue');
                // barcodeValue.innerText = base64;
            };
        });
    });

    const bD = {};
            bD.trigger=()=>{
                let imageEl = document.getElementById('barcodeContainingImage').value;
                            bD.detect(imageEl)  ;
            }
            bD.writeBarcodeData = (data)=>{
                document.getElementById("theBarcodeValue").innerHTML+=data;
            }
            bD.detect = (imageEl)=>{
                // check compatibility
                if (!('BarcodeDetector' in window)) {
                    console.log('Barcode Detector is not supported by this browser.');
                } else {
                    console.log('Barcode Detector supported!');
                    // create new detector
                    var barcodeDetector = new BarcodeDetector({formats: ['code_39', 'codabar', 'ean_13']});
                }

                // check supported types
                BarcodeDetector.getSupportedFormats()
                    .then(supportedFormats => {
                        supportedFormats.forEach(format => console.log(format));
                    });


                barcodeDetector.detect(imageEl)
                    .then(barcodes => {
                        barcodes.forEach(barcode => bD.writeBarcodeData(barcode.rawData));
                    })
                    .catch(err => {
                        console.log(err);
                    })
            }



</script>
</body>
</html>
